<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Sun Oct 23 23:57:31 CST 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>DefaultBlockFileSystem</title>
<meta name="date" content="2016-10-23">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="DefaultBlockFileSystem";
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="跳过导航链接"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/util/ms/Cp1252.html" title="org.archive.util.ms中的类"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../org/archive/util/ms/Doc.html" title="org.archive.util.ms中的类"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/util/ms/DefaultBlockFileSystem.html" target="_top">框架</a></li>
<li><a href="DefaultBlockFileSystem.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.archive.util.ms</div>
<h2 title="类 DefaultBlockFileSystem" class="title">类 DefaultBlockFileSystem</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.archive.util.ms.DefaultBlockFileSystem</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已实现的接口:</dt>
<dd><a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">DefaultBlockFileSystem</span>
extends java.lang.Object
implements <a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></pre>
<div class="block">Default implementation of the Block File System.
 
 <p>The overall structure of a BlockFileSystem file (such as a .doc file) is
 as follows.  The file is divided into blocks, which are of uniform length
 (512 bytes).  The first block (at file pointer 0) is called the header
 block.  It's used to look up other blocks in the file.
 
 <p>Subfiles contained within the .doc file are organized using a Block
 Allocation Table, or BAT.  The BAT is basically a linked list; given a 
 block number, the BAT will tell you the next block number.  Note that
 the header block has no number; block #0 is the first block after the
 header.  Thus, to convert a block number to a file pointer:
 <code>int filePointer = (blockNumber + 1) * BLOCK_SIZE</code>.
 
 <p>The BAT itself is discontinuous, however.  To find the blocks that 
 comprise the BAT, you have to look in the header block.  The header block
 contains an array of 109 pointers to the blocks that comprise the BAT.
 If more than 109 BAT blocks are required (in other words, if the .doc
 file is larger than ~6 megabytes), then something called the 
 XBAT comes into play.
 
 <p>XBAT blocks contain pointers to the 110th BAT block and beyond.
 The first XBAT block is stored at a file pointer listed in the header.
 The other XBAT blocks are always stored in order after the first; the 
 XBAT table is continuous.  One is inclined to wonder why the BAT itself
 is not so stored, but oh well.
 
 <p>The BAT only tells you the next block for a given block.  To find the 
 first block for a subfile, you have to look up that subfile's directory
 entry.  Each directory entry is a 128 byte structure in the file, so four
 of them fit in a block.  The number of the first block of the entry list
 is stored in the header.  To find subsequent entry blocks, the BAT must
 be used.
 
 <p>I'm telling you all this so that you understand the caching that this
 class provides.
 
 <p>First, directory entries are not cached.  It's assumed that they will
 be looked up at the beginning of a lengthy operation, and then forgotten
 about.  This is certainly the case for <code>Doc#getText(BlockFileSystem)</code>. 
 If you need to remember directory entries, you can manually store the Entry 
 objects in a map or something, as they don't grow stale.
 
 <p>This class keeps all 512 bytes of the header block in memory at all 
 times.  This prevents a potentially expensive file pointer repositioning
 every time you're trying to figure out what comes next.
 
 <p>BAT and XBAT blocks are stored in a least-recently used cache.  The 
 <i>n</i> most recent BAT and XBAT blocks are remembered, where <i>n</i>
 is set at construction time.  The minimum value of <i>n</i> is 1.  For small
 files, this can prevent file pointer repositioning for BAT look ups.
 
 <p>The BAT/XBAT cache only takes up memory as needed.  If the specified
 cache size is 100 blocks, but the file only has 4 BAT blocks, then only 
 2048 bytes will be used by the cache.
 
 <p>Note this class only caches BAT and XBAT blocks.  It does not cache the
 blocks that actually make up a subfile's contents.  It is assumed that those
 blocks will only be accessed once per operation (again, this is what
 {Doc.getText(BlockFileSystem)} typically requires.)</div>
<dl><dt><span class="strong">另请参阅:</span></dt><dd><code>http://jakarta.apache.org/poi/poifs/fileformat.html</code></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>字段概要</h3>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.archive.util.ms.BlockFileSystem">
<!--   -->
</a>
<h3>从接口继承的字段&nbsp;org.archive.util.ms.<a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></h3>
<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#BLOCK_SIZE">BLOCK_SIZE</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>构造器概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="构造器概要表, 列表构造器和解释">
<caption><span>构造器</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">构造器和说明</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/archive/util/ms/DefaultBlockFileSystem.html#DefaultBlockFileSystem(org.archive.io.SeekInputStream,%20int)">DefaultBlockFileSystem</a></strong>(<a href="../../../../org/archive/io/SeekInputStream.html" title="org.archive.io中的类">SeekInputStream</a>&nbsp;input,
                      int&nbsp;batCacheSize)</code>
<div class="block">Constructor.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span>方法</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/util/ms/DefaultBlockFileSystem.html#getNextBlock(int)">getNextBlock</a></strong>(int&nbsp;block)</code>
<div class="block">Returns the number of the block that follows the given block.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../org/archive/io/SeekInputStream.html" title="org.archive.io中的类">SeekInputStream</a></code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/util/ms/DefaultBlockFileSystem.html#getRawInput()">getRawInput</a></strong>()</code>
<div class="block">Returns the raw input stream for this file system.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../org/archive/util/ms/Entry.html" title="org.archive.util.ms中的接口">Entry</a></code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/util/ms/DefaultBlockFileSystem.html#getRoot()">getRoot</a></strong>()</code>
<div class="block">Returns the root entry of the file system.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>从类继承的方法&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>构造器详细资料</h3>
<a name="DefaultBlockFileSystem(org.archive.io.SeekInputStream, int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DefaultBlockFileSystem</h4>
<pre>public&nbsp;DefaultBlockFileSystem(<a href="../../../../org/archive/io/SeekInputStream.html" title="org.archive.io中的类">SeekInputStream</a>&nbsp;input,
                      int&nbsp;batCacheSize)
                       throws java.io.IOException</pre>
<div class="block">Constructor.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>input</code> - the file to read from</dd><dd><code>batCacheSize</code> - number of BAT and XBAT blocks to cache</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code> - if an IO error occurs</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="getRoot()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRoot</h4>
<pre>public&nbsp;<a href="../../../../org/archive/util/ms/Entry.html" title="org.archive.util.ms中的接口">Entry</a>&nbsp;getRoot()
              throws java.io.IOException</pre>
<div class="block"><strong>从接口复制的说明:&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getRoot()">BlockFileSystem</a></code></strong></div>
<div class="block">Returns the root entry of the file system.  Subfiles and directories
 can be found by searching the returned entry.</div>
<dl>
<dt><strong>指定者:</strong></dt>
<dd><code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getRoot()">getRoot</a></code>&nbsp;在接口中&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></code></dd>
<dt><span class="strong">返回:</span></dt><dd>the root entry</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code> - if an IO error occurs</dd></dl>
</li>
</ul>
<a name="getNextBlock(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getNextBlock</h4>
<pre>public&nbsp;int&nbsp;getNextBlock(int&nbsp;block)
                 throws java.io.IOException</pre>
<div class="block"><strong>从接口复制的说明:&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getNextBlock(int)">BlockFileSystem</a></code></strong></div>
<div class="block">Returns the number of the block that follows the given block.
 The internal block allocation tables are consulted to determine the
 next block.  A return value that is less than zero indicates that
 there is no next block.</div>
<dl>
<dt><strong>指定者:</strong></dt>
<dd><code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getNextBlock(int)">getNextBlock</a></code>&nbsp;在接口中&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></code></dd>
<dt><span class="strong">参数:</span></dt><dd><code>block</code> - the number of block whose successor to return</dd>
<dt><span class="strong">返回:</span></dt><dd>the successor of that block</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code> - if an IO error occurs</dd></dl>
</li>
</ul>
<a name="getRawInput()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getRawInput</h4>
<pre>public&nbsp;<a href="../../../../org/archive/io/SeekInputStream.html" title="org.archive.io中的类">SeekInputStream</a>&nbsp;getRawInput()</pre>
<div class="block"><strong>从接口复制的说明:&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getRawInput()">BlockFileSystem</a></code></strong></div>
<div class="block">Returns the raw input stream for this file system.  
 Typically this will be the random access file containing the .doc.</div>
<dl>
<dt><strong>指定者:</strong></dt>
<dd><code><a href="../../../../org/archive/util/ms/BlockFileSystem.html#getRawInput()">getRawInput</a></code>&nbsp;在接口中&nbsp;<code><a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></code></dd>
<dt><span class="strong">返回:</span></dt><dd>the raw input stream for this file system</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="跳过导航链接"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/util/ms/Cp1252.html" title="org.archive.util.ms中的类"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../org/archive/util/ms/Doc.html" title="org.archive.util.ms中的类"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/util/ms/DefaultBlockFileSystem.html" target="_top">框架</a></li>
<li><a href="DefaultBlockFileSystem.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
