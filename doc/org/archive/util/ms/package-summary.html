<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Sun Oct 23 23:57:35 CST 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>org.archive.util.ms</title>
<meta name="date" content="2016-10-23">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="org.archive.util.ms";
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="跳过导航链接"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li class="navBarCell1Rev">程序包</li>
<li>类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/util/iterator/package-summary.html">上一个程序包</a></li>
<li><a href="../../../../st/ata/util/package-summary.html">下一个程序包</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/util/ms/package-summary.html" target="_top">框架</a></li>
<li><a href="package-summary.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="程序包" class="title">程序包&nbsp;org.archive.util.ms</h1>
<div class="docSummary">
<div class="block">Memory-efficient reading of .doc files.</div>
</div>
<p>请参阅:&nbsp;<a href="#package_description">说明</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="接口概要表, 列表接口和解释">
<caption><span>接口概要</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">接口</th>
<th class="colLast" scope="col">说明</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/BlockFileSystem.html" title="org.archive.util.ms中的接口">BlockFileSystem</a></td>
<td class="colLast">
<div class="block">Describes the internal file system contained in .doc files.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/Entry.html" title="org.archive.util.ms中的接口">Entry</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="类概要表, 列表类和解释">
<caption><span>类概要</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">类</th>
<th class="colLast" scope="col">说明</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/BlockInputStream.html" title="org.archive.util.ms中的类">BlockInputStream</a></td>
<td class="colLast">
<div class="block">InputStream for a file contained in a BlockFileSystem.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/Cp1252.html" title="org.archive.util.ms中的类">Cp1252</a></td>
<td class="colLast">
<div class="block">A fast implementation of code page 1252.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/DefaultBlockFileSystem.html" title="org.archive.util.ms中的类">DefaultBlockFileSystem</a></td>
<td class="colLast">
<div class="block">Default implementation of the Block File System.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/Doc.html" title="org.archive.util.ms中的类">Doc</a></td>
<td class="colLast">
<div class="block">Reads .doc files.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/DocTest.html" title="org.archive.util.ms中的类">DocTest</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/Piece.html" title="org.archive.util.ms中的类">Piece</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/PieceReaderTest.html" title="org.archive.util.ms中的类">PieceReaderTest</a></td>
<td class="colLast">
<div class="block">Unit test for PieceReader.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="枚举概要表, 列表枚举和解释">
<caption><span>枚举概要</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">枚举</th>
<th class="colLast" scope="col">说明</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/archive/util/ms/Entry.EntryType.html" title="org.archive.util.ms中的枚举">Entry.EntryType</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package_description">
<!--   -->
</a>
<h2 title="程序包org.archive.util.ms的说明">程序包org.archive.util.ms的说明</h2>
<div class="block">Memory-efficient reading of .doc files.  To extract the text from a .doc
file, use <a href="../../../../org/archive/util/ms/Doc.html#getText(org.archive.io.SeekInputStream)"><code>Doc.getText(SeekInputStream)</code></a>.  That's
basically the whole API.  The other classes are necessary to make that
method work, and you can probably ignore them.  

<h2>Implementation/Format Details</h2>

<p>These APIs differ from the POI API provided by Apache in that POI wants to 
load complete documents into memory.  Though POI does provide an "event-driven" 
API that is memory efficient, that API cannot be used to scan text across block 
or piece boundaries.

<p>This package provides a stream-based API for extracting the text of
a .doc file.  At this time, the package does not provide a way to extract 
style attributes, embedded images, subdocuments, change tracking information,
and so on.

<p>There are two layers of abstraction between the contents of a .doc
file and reality.  The first layer is the <i>Block File System</i>, and
the second layer is the <i>piece table</i>.

<h3>The Block File System</h3>

<p>All .doc files are secretly file systems, like a .iso file, but insane.
A good overview of how this file system is arranged inside the file is
available at <a href="http://jakarta.apache.org/poi/poifs/fileformat.html">
the Jarkarta POIFS</a> system.

<p>Subfiles and directories in a block file system are represented via the
<a href="../../../../org/archive/util/ms/Entry.html" title="org.archive.util.ms中的接口"><code>Entry</code></a> interface.  The root directory can be
obtained via the <a href="../../../../org/archive/util/ms/BlockFileSystem.html#getRoot()"><code>BlockFileSystem.getRoot()</code></a>
method.  From there, the child entries can be discovered.

<p>The file system divides its subfiles into 512-byte blocks.  Those blocks
are not necessarily stored in a linear order; blocks from different subfiles
may be interspersed with each other.  The 
<a href="../../../../org/archive/util/ms/Entry.html#open()"><code>Entry.open()</code></a> method returns an input stream that
provides a continuous view of a subfile's contents.  It does so by moving 
the file pointer of the .doc file behind the scenes.

<p>It's important to keep in mind that any given read on a stream produced
by a BlockFileSystem may involve:

<ol>
<li>Moving the file pointer to the start of the file to look up the main
block allocation table.</li>
<li>Navigation the file pointer through various allocation structures located
throughout the file.</li>
<li>Finally repositioning the file pointer at the start of the next block
to be read.</li>
</ol>

<p>So, this package lowers memory consumption at the expense of greater IO
activity.  A future version of this package will use internal caches to 
minimize IO activity, providing tunable trade-offs between memory and IO.

<h3>The Piece Table</h3>

<p>The second layer of abstraction between you and the contents of a .doc file 
is the piece table.  Some .doc files are produced using a "fast-save" feature
that only writes recent changes to the end of the file.  In this case, the
text of the document may be fragmented within the document stream itself.
Note that this fragmentation is in addition to the block fragmentation
described above.

<p>A .doc file contains several subfiles within its filesystem.  The two 
that are important for extracting text are named <code>WordDocument</code>
and <code>0Table</code>.  The <code>WordDocument</code> subfile contains the 
text of the document.  The <code>0Table</code> subfile contains supporting
information, including the piece table.

<p>The piece table is a simple map from logical character position to actual
subfile stream position.  Additionally, each piece table entry describes whether
or not the piece stores text using 16-bit Unicode, or using 8-bit ANSI
codes.  One .doc file can contain both Unicode and ANSI text.  A consequence
of this is that <i>every</i> .doc file has a piece table, even those that
were not "fast-saved".

<p>The reader returned by 
<code>org.achive.util.ms.Doc#getText(SeekInputStream)</code> consults the piece
table to determine where in the WordDocument subfile the next piece of text
is located.  It also uses the piece table to determine how bytes should be
converted to Unicode characters.

<p>Note, however, that any read from such a reader may involve:

<ol>
<li>Moving the file pointer to the piece table.</li>
<li>Searching the piece table index for the next piece, which may
involve moving the file pointer many times.</li>
<li>Moving the file pointer to that piece's description in the piece table.</li>
<li>Moving the file pointer to the start of the piece indicated by the
description.</li>
</ol>

Since the "file pointer" in this context is the file pointer of the 
<i>subfile</i>, each move described above may additionally involve:

<ol>
<li>Moving the file pointer to the piece table.</li>
<li>Searching the piece table index for the next piece, which may
involve moving the file pointer many times.</li>
<li>Moving the file pointer to that piece's description in the piece table.</li>
<li>Moving the file pointer to the start of the piece indicated by the
description.</li>
</ol>

A future implementation will provide an intelligent cache of the piece table,
which will hopefully reduce the IO activity required.</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="跳过导航链接"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li class="navBarCell1Rev">程序包</li>
<li>类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/util/iterator/package-summary.html">上一个程序包</a></li>
<li><a href="../../../../st/ata/util/package-summary.html">下一个程序包</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/util/ms/package-summary.html" target="_top">框架</a></li>
<li><a href="package-summary.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
