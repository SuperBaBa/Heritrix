<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Sun Oct 23 23:57:32 CST 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ARCWriter</title>
<meta name="date" content="2016-10-23">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ARCWriter";
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="跳过导航链接"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/io/arc/ARCUtils.html" title="org.archive.io.arc中的类"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../org/archive/io/arc/ARCWriterPool.html" title="org.archive.io.arc中的类"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/io/arc/ARCWriter.html" target="_top">框架</a></li>
<li><a href="ARCWriter.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li><a href="#fields_inherited_from_class_org.archive.io.WriterPoolMember">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.archive.io.arc</div>
<h2 title="类 ARCWriter" class="title">类 ARCWriter</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../org/archive/io/WriterPoolMember.html" title="org.archive.io中的类">org.archive.io.WriterPoolMember</a></li>
<li>
<ul class="inheritance">
<li>org.archive.io.arc.ARCWriter</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已实现的接口:</dt>
<dd><a href="../../../../org/archive/io/arc/ARCConstants.html" title="org.archive.io.arc中的接口">ARCConstants</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html" title="org.archive.io中的接口">ArchiveFileConstants</a></dd>
</dl>
<dl>
<dt>直接已知子类:</dt>
<dd><a href="../../../../org/archive/io/arc/ARCWriterTest.CorruptibleARCWriter.html" title="org.archive.io.arc中的类">ARCWriterTest.CorruptibleARCWriter</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">ARCWriter</span>
extends <a href="../../../../org/archive/io/WriterPoolMember.html" title="org.archive.io中的类">WriterPoolMember</a>
implements <a href="../../../../org/archive/io/arc/ARCConstants.html" title="org.archive.io.arc中的接口">ARCConstants</a></pre>
<div class="block">Write ARC files.

 Assumption is that the caller is managing access to this ARCWriter ensuring
 only one thread of control accessing this ARC file instance at any one time.

 <p>ARC files are described here:
 <a href="http://www.archive.org/web/researcher/ArcFileFormat.php">Arc
 File Format</a>.  This class does version 1 of the ARC file format.  It also
 writes version 1.1 which is version 1 with data stuffed into the body of the
 first arc record in the file, the arc file meta record itself.

 <p>An ARC file is three lines of meta data followed by an optional 'body' and
 then a couple of '\n' and then: record, '\n', record, '\n', record, etc.
 If we are writing compressed ARC files, then each of the ARC file records is
 individually gzipped and concatenated together to make up a single ARC file.
 In GZIP terms, each ARC record is a GZIP <i>member</i> of a total gzip'd
 file.

 <p>The GZIPping of the ARC file meta data is exceptional.  It is GZIPped
 w/ an extra GZIP header, a special Internet Archive (IA) extra header field
 (e.g. FEXTRA is set in the GZIP header FLG field and an extra field is
 appended to the GZIP header).  The extra field has little in it but its
 presence denotes this GZIP as an Internet Archive gzipped ARC.  See RFC1952
 to learn about the GZIP header structure.

 <p>This class then does its GZIPping in the following fashion.  Each GZIP
 member is written w/ a new instance of GZIPOutputStream -- actually
 ARCWriterGZIPOututStream so we can get access to the underlying stream.
 The underlying stream stays open across GZIPoutputStream instantiations.
 For the 'special' GZIPing of the ARC file meta data, we cheat by catching the
 GZIPOutputStream output into a byte array, manipulating it adding the
 IA GZIP header, before writing to the stream.

 <p>I tried writing a resettable GZIPOutputStream and could make it work w/
 the SUN JDK but the IBM JDK threw NPE inside in the deflate.reset -- its zlib
 native call doesn't seem to like the notion of resetting -- so I gave up on
 it.

 <p>Because of such as the above and troubles with GZIPInputStream, we should
 write our own GZIP*Streams, ones that resettable and consious of gzip
 members.

 <p>This class will write until we hit >= maxSize.  The check is done at
 record boundary.  Records do not span ARC files.  We will then close current
 file and open another and then continue writing.

 <p><b>TESTING: </b>Here is how to test that produced ARC files are good
 using the
 <a href="http://www.archive.org/web/researcher/tool_documentation.php">alexa
 ARC c-tools</a>:
 <pre>
 % av_procarc hx20040109230030-0.arc.gz | av_ziparc > \
     /tmp/hx20040109230030-0.dat.gz
 % av_ripdat /tmp/hx20040109230030-0.dat.gz > /tmp/hx20040109230030-0.cdx
 </pre>
 Examine the produced cdx file to make sure it makes sense.  Search
 for 'no-type 0'.  If found, then we're opening a gzip record w/o data to
 write.  This is bad.

 <p>You can also do <code>gzip -t FILENAME</code> and it will tell you if the
 ARC makes sense to GZIP.
 
 <p>While being written, ARCs have a '.open' suffix appended.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>字段概要</h3>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.archive.io.WriterPoolMember">
<!--   -->
</a>
<h3>从类继承的字段&nbsp;org.archive.io.<a href="../../../../org/archive/io/WriterPoolMember.html" title="org.archive.io中的类">WriterPoolMember</a></h3>
<code><a href="../../../../org/archive/io/WriterPoolMember.html#DEFAULT_PREFIX">DEFAULT_PREFIX</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#DEFAULT_SUFFIX">DEFAULT_SUFFIX</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#HOSTNAME_ADMINPORT_VARIABLE">HOSTNAME_ADMINPORT_VARIABLE</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#HOSTNAME_VARIABLE">HOSTNAME_VARIABLE</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#UTF8">UTF8</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.archive.io.arc.ARCConstants">
<!--   -->
</a>
<h3>从接口继承的字段&nbsp;org.archive.io.arc.<a href="../../../../org/archive/io/arc/ARCConstants.html" title="org.archive.io.arc中的接口">ARCConstants</a></h3>
<code><a href="../../../../org/archive/io/arc/ARCConstants.html#ARC_FILE_EXTENSION">ARC_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#ARC_GZIP_EXTRA_FIELD">ARC_GZIP_EXTRA_FIELD</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#ARC_MAGIC_NUMBER">ARC_MAGIC_NUMBER</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#CHECKSUM_FIELD_KEY">CHECKSUM_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#CHECKSUM_HEADER_FIELD_KEY">CHECKSUM_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#CODE_HEADER_FIELD_KEY">CODE_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#COMPRESSED_ARC_FILE_EXTENSION">COMPRESSED_ARC_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DEFAULT_ENCODING">DEFAULT_ENCODING</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DEFAULT_GZIP_HEADER_LENGTH">DEFAULT_GZIP_HEADER_LENGTH</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DEFAULT_MAX_ARC_FILE_SIZE">DEFAULT_MAX_ARC_FILE_SIZE</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DOT_ARC_FILE_EXTENSION">DOT_ARC_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DOT_COMPRESSED_ARC_FILE_EXTENSION">DOT_COMPRESSED_ARC_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#DOT_COMPRESSED_FILE_EXTENSION">DOT_COMPRESSED_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#FILENAME_FIELD_KEY">FILENAME_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#FILENAME_HEADER_FIELD_KEY">FILENAME_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#GZIP_HEADER_BEGIN">GZIP_HEADER_BEGIN</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#HEADER_FIELD_SEPARATOR">HEADER_FIELD_SEPARATOR</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#IP_HEADER_FIELD_KEY">IP_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#LINE_SEPARATOR">LINE_SEPARATOR</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#LOCATION_HEADER_FIELD_KEY">LOCATION_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#MAX_METADATA_LINE_LENGTH">MAX_METADATA_LINE_LENGTH</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#MINIMUM_RECORD_LENGTH">MINIMUM_RECORD_LENGTH</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#OFFSET_FIELD_KEY">OFFSET_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#OFFSET_HEADER_FIELD_KEY">OFFSET_HEADER_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#REQUIRED_VERSION_1_HEADER_FIELDS">REQUIRED_VERSION_1_HEADER_FIELDS</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#STATUSCODE_FIELD_KEY">STATUSCODE_FIELD_KEY</a>, <a href="../../../../org/archive/io/arc/ARCConstants.html#TOKENIZED_PREFIX">TOKENIZED_PREFIX</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.archive.io.ArchiveFileConstants">
<!--   -->
</a>
<h3>从接口继承的字段&nbsp;org.archive.io.<a href="../../../../org/archive/io/ArchiveFileConstants.html" title="org.archive.io中的接口">ArchiveFileConstants</a></h3>
<code><a href="../../../../org/archive/io/ArchiveFileConstants.html#ABSOLUTE_OFFSET_KEY">ABSOLUTE_OFFSET_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#CDX">CDX</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#CDX_FILE">CDX_FILE</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#CDX_LINE_BUFFER_SIZE">CDX_LINE_BUFFER_SIZE</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#COMPRESSED_FILE_EXTENSION">COMPRESSED_FILE_EXTENSION</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#CRLF">CRLF</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#DATE_FIELD_KEY">DATE_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#DEFAULT_DIGEST_METHOD">DEFAULT_DIGEST_METHOD</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#DUMP">DUMP</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#GZIP_DUMP">GZIP_DUMP</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#HEADER">HEADER</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#INVALID_SUFFIX">INVALID_SUFFIX</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#LENGTH_FIELD_KEY">LENGTH_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#MIMETYPE_FIELD_KEY">MIMETYPE_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#NOHEAD">NOHEAD</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#OCCUPIED_SUFFIX">OCCUPIED_SUFFIX</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#READER_IDENTIFIER_FIELD_KEY">READER_IDENTIFIER_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#RECORD_IDENTIFIER_FIELD_KEY">RECORD_IDENTIFIER_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#SINGLE_SPACE">SINGLE_SPACE</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#TYPE_FIELD_KEY">TYPE_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#URL_FIELD_KEY">URL_FIELD_KEY</a>, <a href="../../../../org/archive/io/ArchiveFileConstants.html#VERSION_FIELD_KEY">VERSION_FIELD_KEY</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>构造器概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="构造器概要表, 列表构造器和解释">
<caption><span>构造器</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">构造器和说明</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#ARCWriter(java.util.concurrent.atomic.AtomicInteger,%20java.util.List,%20java.lang.String,%20boolean,%20long)">ARCWriter</a></strong>(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.util.List&lt;java.io.File&gt;&nbsp;dirs,
         java.lang.String&nbsp;prefix,
         boolean&nbsp;cmprs,
         long&nbsp;maxSize)</code>
<div class="block">Constructor.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#ARCWriter(java.util.concurrent.atomic.AtomicInteger,%20java.util.List,%20java.lang.String,%20java.lang.String,%20boolean,%20long,%20java.util.List)">ARCWriter</a></strong>(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.util.List&lt;java.io.File&gt;&nbsp;dirs,
         java.lang.String&nbsp;prefix,
         java.lang.String&nbsp;suffix,
         boolean&nbsp;cmprs,
         long&nbsp;maxSize,
         java.util.List&nbsp;meta)</code>
<div class="block">Constructor.</div>
</td>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#ARCWriter(java.util.concurrent.atomic.AtomicInteger,%20java.io.PrintStream,%20java.io.File,%20boolean,%20java.lang.String,%20java.util.List)">ARCWriter</a></strong>(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.io.PrintStream&nbsp;out,
         java.io.File&nbsp;arc,
         boolean&nbsp;cmprs,
         java.lang.String&nbsp;a14DigitDate,
         java.util.List&nbsp;metadata)</code>
<div class="block">Constructor.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span>方法</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#createFile()">createFile</a></strong>()</code>
<div class="block">Create a new file.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#createMetaline(java.lang.String,%20java.lang.String,%20java.lang.String,%20java.lang.String,%20java.lang.String)">createMetaline</a></strong>(java.lang.String&nbsp;uri,
              java.lang.String&nbsp;hostIP,
              java.lang.String&nbsp;timeStamp,
              java.lang.String&nbsp;mimetype,
              java.lang.String&nbsp;recordLength)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#getMetadataHeaderLinesTwoAndThree(java.lang.String)">getMetadataHeaderLinesTwoAndThree</a></strong>(java.lang.String&nbsp;version)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#getMetaLine(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20long)">getMetaLine</a></strong>(java.lang.String&nbsp;uri,
           java.lang.String&nbsp;contentType,
           java.lang.String&nbsp;hostIP,
           long&nbsp;fetchBeginTimeStamp,
           long&nbsp;recordLength)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#validateMetaLine(java.lang.String)">validateMetaLine</a></strong>(java.lang.String&nbsp;metaLineStr)</code>
<div class="block">Test that the metadata line is valid before writing.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#write(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20long,%20java.io.ByteArrayOutputStream)">write</a></strong>(java.lang.String&nbsp;uri,
     java.lang.String&nbsp;contentType,
     java.lang.String&nbsp;hostIP,
     long&nbsp;fetchBeginTimeStamp,
     long&nbsp;recordLength,
     java.io.ByteArrayOutputStream&nbsp;baos)</code>
<div class="block"><strong>已过时。</strong>&nbsp;
<div class="block"><i>use input-stream version directly instead</i></div>
</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#write(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20long,%20java.io.InputStream)">write</a></strong>(java.lang.String&nbsp;uri,
     java.lang.String&nbsp;contentType,
     java.lang.String&nbsp;hostIP,
     long&nbsp;fetchBeginTimeStamp,
     long&nbsp;recordLength,
     java.io.InputStream&nbsp;in)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/archive/io/arc/ARCWriter.html#write(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20long,%20java.io.InputStream,%20boolean)">write</a></strong>(java.lang.String&nbsp;uri,
     java.lang.String&nbsp;contentType,
     java.lang.String&nbsp;hostIP,
     long&nbsp;fetchBeginTimeStamp,
     long&nbsp;recordLength,
     java.io.InputStream&nbsp;in,
     boolean&nbsp;enforceLength)</code>
<div class="block">Write a record with the given metadata/content.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_org.archive.io.WriterPoolMember">
<!--   -->
</a>
<h3>从类继承的方法&nbsp;org.archive.io.<a href="../../../../org/archive/io/WriterPoolMember.html" title="org.archive.io中的类">WriterPoolMember</a></h3>
<code><a href="../../../../org/archive/io/WriterPoolMember.html#checkSize()">checkSize</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#checkWriteable(java.io.File)">checkWriteable</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#close()">close</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#copyFrom(java.io.InputStream,%20long,%20boolean)">copyFrom</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#createFile(java.io.File)">createFile</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#flush()">flush</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getBaseFilename()">getBaseFilename</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getCreateTimestamp()">getCreateTimestamp</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getFile()">getFile</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getNextDirectory(java.util.List)">getNextDirectory</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getOutputStream()">getOutputStream</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getPosition()">getPosition</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getTimestampSerialNo()">getTimestampSerialNo</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#getTimestampSerialNo(java.lang.String)">getTimestampSerialNo</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#isCompressed()">isCompressed</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#postWriteRecordTasks()">postWriteRecordTasks</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#preWriteRecordTasks()">preWriteRecordTasks</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#readFullyFrom(java.io.InputStream,%20long,%20byte[])">readFullyFrom</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#readToLimitFrom(java.io.InputStream,%20long,%20byte[])">readToLimitFrom</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#write(byte[])">write</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#write(byte[],%20int,%20int)">write</a>, <a href="../../../../org/archive/io/WriterPoolMember.html#write(int)">write</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>从类继承的方法&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>构造器详细资料</h3>
<a name="ARCWriter(java.util.concurrent.atomic.AtomicInteger, java.io.PrintStream, java.io.File, boolean, java.lang.String, java.util.List)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ARCWriter</h4>
<pre>public&nbsp;ARCWriter(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.io.PrintStream&nbsp;out,
         java.io.File&nbsp;arc,
         boolean&nbsp;cmprs,
         java.lang.String&nbsp;a14DigitDate,
         java.util.List&nbsp;metadata)
          throws java.io.IOException</pre>
<div class="block">Constructor.
 Takes a stream. Use with caution. There is no upperbound check on size.
 Will just keep writing.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>serialNo</code> - used to generate unique file name sequences</dd><dd><code>out</code> - Where to write.</dd><dd><code>arc</code> - File the <code>out</code> is connected to.</dd><dd><code>cmprs</code> - Compress the content written.</dd><dd><code>metadata</code> - File meta data.  Can be null.  Is list of File and/or
 String objects.</dd><dd><code>a14DigitDate</code> - If null, we'll write current time.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="ARCWriter(java.util.concurrent.atomic.AtomicInteger, java.util.List, java.lang.String, boolean, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ARCWriter</h4>
<pre>public&nbsp;ARCWriter(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.util.List&lt;java.io.File&gt;&nbsp;dirs,
         java.lang.String&nbsp;prefix,
         boolean&nbsp;cmprs,
         long&nbsp;maxSize)</pre>
<div class="block">Constructor.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>serialNo</code> - used to generate unique file name sequences</dd><dd><code>dirs</code> - Where to drop the ARC files.</dd><dd><code>prefix</code> - ARC file prefix to use.  If null, we use
 DEFAULT_ARC_FILE_PREFIX.</dd><dd><code>cmprs</code> - Compress the ARC files written.  The compression is done
 by individually gzipping each record added to the ARC file: i.e. the
 ARC file is a bunch of gzipped records concatenated together.</dd><dd><code>maxSize</code> - Maximum size for ARC files written.</dd></dl>
</li>
</ul>
<a name="ARCWriter(java.util.concurrent.atomic.AtomicInteger, java.util.List, java.lang.String, java.lang.String, boolean, long, java.util.List)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ARCWriter</h4>
<pre>public&nbsp;ARCWriter(java.util.concurrent.atomic.AtomicInteger&nbsp;serialNo,
         java.util.List&lt;java.io.File&gt;&nbsp;dirs,
         java.lang.String&nbsp;prefix,
         java.lang.String&nbsp;suffix,
         boolean&nbsp;cmprs,
         long&nbsp;maxSize,
         java.util.List&nbsp;meta)</pre>
<div class="block">Constructor.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>serialNo</code> - used to generate unique file name sequences</dd><dd><code>dirs</code> - Where to drop files.</dd><dd><code>prefix</code> - File prefix to use.</dd><dd><code>cmprs</code> - Compress the records written.</dd><dd><code>maxSize</code> - Maximum size for ARC files written.</dd><dd><code>suffix</code> - File tail to use.  If null, unused.</dd><dd><code>meta</code> - File meta data.  Can be null.  Is list of File and/or
 String objects.</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="createFile()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createFile</h4>
<pre>protected&nbsp;java.lang.String&nbsp;createFile()
                               throws java.io.IOException</pre>
<div class="block"><strong>从类复制的说明:&nbsp;<code><a href="../../../../org/archive/io/WriterPoolMember.html#createFile()">WriterPoolMember</a></code></strong></div>
<div class="block">Create a new file.
 Rotates off the current Writer and creates a new in its place
 to take subsequent writes.  Usually called from <a href="../../../../org/archive/io/WriterPoolMember.html#checkSize()"><code>WriterPoolMember.checkSize()</code></a>.</div>
<dl>
<dt><strong>覆盖:</strong></dt>
<dd><code><a href="../../../../org/archive/io/WriterPoolMember.html#createFile()">createFile</a></code>&nbsp;在类中&nbsp;<code><a href="../../../../org/archive/io/WriterPoolMember.html" title="org.archive.io中的类">WriterPoolMember</a></code></dd>
<dt><span class="strong">返回:</span></dt><dd>Name of file created.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="getMetadataHeaderLinesTwoAndThree(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMetadataHeaderLinesTwoAndThree</h4>
<pre>public&nbsp;java.lang.String&nbsp;getMetadataHeaderLinesTwoAndThree(java.lang.String&nbsp;version)</pre>
</li>
</ul>
<a name="write(java.lang.String, java.lang.String, java.lang.String, long, long, java.io.ByteArrayOutputStream)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(java.lang.String&nbsp;uri,
         java.lang.String&nbsp;contentType,
         java.lang.String&nbsp;hostIP,
         long&nbsp;fetchBeginTimeStamp,
         long&nbsp;recordLength,
         java.io.ByteArrayOutputStream&nbsp;baos)
           throws java.io.IOException</pre>
<div class="block"><span class="strong">已过时。</span>&nbsp;<i>use input-stream version directly instead</i></div>
<dl><dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="write(java.lang.String, java.lang.String, java.lang.String, long, long, java.io.InputStream)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(java.lang.String&nbsp;uri,
         java.lang.String&nbsp;contentType,
         java.lang.String&nbsp;hostIP,
         long&nbsp;fetchBeginTimeStamp,
         long&nbsp;recordLength,
         java.io.InputStream&nbsp;in)
           throws java.io.IOException</pre>
<dl><dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="write(java.lang.String, java.lang.String, java.lang.String, long, long, java.io.InputStream, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(java.lang.String&nbsp;uri,
         java.lang.String&nbsp;contentType,
         java.lang.String&nbsp;hostIP,
         long&nbsp;fetchBeginTimeStamp,
         long&nbsp;recordLength,
         java.io.InputStream&nbsp;in,
         boolean&nbsp;enforceLength)
           throws java.io.IOException</pre>
<div class="block">Write a record with the given metadata/content.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>uri</code> - URI for metadata-line</dd><dd><code>contentType</code> - MIME content-type for metadata-line</dd><dd><code>hostIP</code> - IP for metadata-line</dd><dd><code>fetchBeginTimeStamp</code> - timestamp for metadata-line</dd><dd><code>recordLength</code> - length for metadata-line; also may be enforced</dd><dd><code>in</code> - source InputStream for record content</dd><dd><code>enforceLength</code> - whether to enforce the declared length; should be true
            unless intentionally writing bad records for testing</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="getMetaLine(java.lang.String, java.lang.String, java.lang.String, long, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMetaLine</h4>
<pre>protected&nbsp;java.lang.String&nbsp;getMetaLine(java.lang.String&nbsp;uri,
                           java.lang.String&nbsp;contentType,
                           java.lang.String&nbsp;hostIP,
                           long&nbsp;fetchBeginTimeStamp,
                           long&nbsp;recordLength)
                                throws java.io.IOException</pre>
<dl><dt><span class="strong">参数:</span></dt><dd><code>uri</code> - </dd><dd><code>contentType</code> - </dd><dd><code>hostIP</code> - </dd><dd><code>fetchBeginTimeStamp</code> - </dd><dd><code>recordLength</code> - </dd>
<dt><span class="strong">返回:</span></dt><dd>Metadata line for an ARCRecord made of passed components.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="createMetaline(java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createMetaline</h4>
<pre>public&nbsp;java.lang.String&nbsp;createMetaline(java.lang.String&nbsp;uri,
                              java.lang.String&nbsp;hostIP,
                              java.lang.String&nbsp;timeStamp,
                              java.lang.String&nbsp;mimetype,
                              java.lang.String&nbsp;recordLength)</pre>
</li>
</ul>
<a name="validateMetaLine(java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>validateMetaLine</h4>
<pre>protected&nbsp;java.lang.String&nbsp;validateMetaLine(java.lang.String&nbsp;metaLineStr)
                                     throws java.io.IOException</pre>
<div class="block">Test that the metadata line is valid before writing.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>metaLineStr</code> - </dd>
<dt><span class="strong">返回:</span></dt><dd>The passed in metaline.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="跳过导航链接"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/archive/io/arc/ARCUtils.html" title="org.archive.io.arc中的类"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../org/archive/io/arc/ARCWriterPool.html" title="org.archive.io.arc中的类"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/archive/io/arc/ARCWriter.html" target="_top">框架</a></li>
<li><a href="ARCWriter.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li><a href="#fields_inherited_from_class_org.archive.io.WriterPoolMember">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
